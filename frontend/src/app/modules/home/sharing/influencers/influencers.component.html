
<div class="form-container">
  <div class="loading-container"*ngIf="isLoading">
    <img  src="../../../../../assets/gifs/loading.svg" alt="Loading...">
  </div>
  
  <div class="search-bar" [hidden]="isLoading" >
    <mat-form-field>
      <input
        #searchInput
        matInput
        (keyup)="applyFilterChange('search', searchInput.value)"
        placeholder="🔍 Search"
      />
    </mat-form-field>
  </div>
  
  <div class="filter-container"[hidden]="isLoading">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>filter_list</mat-icon>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-form-field class="filter">
        <mat-label>Gender Filter</mat-label>
        <mat-select #genderSelect multiple placeholder="Gender Filter" (selectionChange)="applyFilterChange('gender', $event.value)">
          <mat-option *ngFor="let gender of allGenders" [value]="gender">{{ gender }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="filter">
        <mat-label>Location Filter</mat-label>
        <mat-select #locationSelect multiple placeholder="Location Filter" (selectionChange)="applyFilterChange('location', $event.value)">
          <mat-option *ngFor="let option of allLocations" [value]="option">
            {{ option }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="filter">
        <mat-label>City Filter</mat-label>
        <mat-select  #citySelect multiple placeholder="City Filter" (selectionChange)="applyFilterChange('city', $event.value)">
          <mat-option *ngFor="let option of allCities" [value]="option">{{ option }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="filter">
        <mat-label>Main Vertical Filter</mat-label>
        <mat-select  #verticalSelect multiple placeholder="Main Vertical Filter" (selectionChange)="applyFilterChange('vertical', $event.value)">
          <mat-option *ngFor="let option of allVerticals" [value]="option">{{ option }}</mat-option>
        </mat-select>
      </mat-form-field>


      <mat-form-field class="filter">
        <mat-label>Nationality Filter</mat-label>
        <mat-select #nationalitySelect multiple placeholder="Nationality Filter" (selectionChange)="applyFilterChange('nationalities', $event.value)">
          <mat-option *ngFor="let option of allNationalities" [value]="option">{{ option }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="filter">
        <mat-label>Social Media Platforms</mat-label>
        <mat-select #socialMediaPlatformSelect placeholder="Social Media" (selectionChange)="applyPlatformFilter($event.value)">
          <mat-option *ngFor="let platform of ['Instagram', 'Tiktok', 'Youtube', 'Twitter', 'Snapchat', 'Facebook']" [value]="platform">{{ platform }}</mat-option>
        </mat-select>
      </mat-form-field>


      <div class="filter">
        <mat-form-field>
          <mat-label>Min Followers</mat-label>
          <input matInput type="number" [(ngModel)]="minFollowers" (ngModelChange)="applyFollowerRangeChange()">

        </mat-form-field>

        <mat-form-field>
          <mat-label>Max Followers</mat-label>
          <input matInput type="number" [(ngModel)]="maxFollowers" (ngModelChange)="applyFollowerRangeChange()">
        </mat-form-field>
      </div>
      <div class="filter">
        <mat-form-field>
          <mat-label>Min CPE</mat-label>
          <input matInput type="number" [(ngModel)]="minCPE" (ngModelChange)="applyCPECPMRangeChange()">
        </mat-form-field>
      
        <mat-form-field>
          <mat-label>Max CPE</mat-label>
          <input matInput type="number" [(ngModel)]="maxCPE" (ngModelChange)="applyCPECPMRangeChange()">
        </mat-form-field>
      </div>
      
      <div class="filter">
        <mat-form-field>
          <mat-label>Min CPM</mat-label>
          <input matInput type="number" [(ngModel)]="minCPM" (ngModelChange)="applyCPECPMRangeChange()">
        </mat-form-field>
      
        <mat-form-field>
          <mat-label>Max CPM</mat-label>
          <input matInput type="number" [(ngModel)]="maxCPM" (ngModelChange)="applyCPECPMRangeChange()">
        </mat-form-field>
      </div>
      

      <button mat-raised-button color="primary" (click)="resetFilters()">Reset Filters</button>
    </mat-expansion-panel>
    <button
      mat-raised-button
      style="
        width: 15%;
        padding: 25px 5px;
        margin-bottom: 10px;
        margin-left: auto;
      "
      routerLink="/home/talent/new/influencer"
      *ngIf="userRole == 'talent'"
    >
      Add New Influencer
    </button>
  </div>

  <div class="table-container" [hidden]="isLoading">
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="Name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="{ 'red-cell': element.ItpRelationship === 'Blacklist' }"
        >
          {{ element.Name }}
        </td>
      </ng-container>

      <ng-container matColumnDef="Gender">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Gender</th>
        <td mat-cell *matCellDef="let element">{{ element.Gender }}</td>
      </ng-container>

      <ng-container matColumnDef="CPE">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>CPE</th>
        <td mat-cell *matCellDef="let element">
          {{ element?.influencerMetrics?.CPE | appCurrencyFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="CPM">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>CPM</th>
        <td mat-cell *matCellDef="let element">
          {{ element?.influencerMetrics?.CPM | appCurrencyFormat : 3 }}
        </td>
      </ng-container>

      <ng-container matColumnDef="marginOfProfit">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Margin</th>
        <td mat-cell *matCellDef="let element">
          {{ element?.influencerMetrics?.marginOfProfit | percent }}
        </td>
      </ng-container>

      <ng-container matColumnDef="InstagramFollowers">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>IG</th>
        <td
          mat-cell
          *matCellDef="let element"
          (click)="openLink(element.InstagramLink)"
        >
          {{ element.InstagramFollowers | numberFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="TiktokFollowers">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>TT</th>
        <td
          mat-cell
          *matCellDef="let element"
          (click)="openLink(element.TiktokLink)"
        >
          {{ element.TiktokFollowers | numberFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="SnapchatFollowers">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>SC</th>
        <td
          mat-cell
          *matCellDef="let element"
          (click)="openLink(element.SnapchatLink)"
        >
          {{ element.SnapchatFollowers | numberFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="TwitterFollowers">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>TW</th>
        <td
          mat-cell
          *matCellDef="let element"
          (click)="openLink(element.TwitterLink)"
        >
          {{ element.TwitterFollowers | numberFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="YoutubeFollowers">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>YT</th>
        <td
          mat-cell
          *matCellDef="let element"
          (click)="openLink(element.YoutubeLink)"
        >
          {{ element.YoutubeFollowers | numberFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="FacebookFollowers">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>FB</th>
        <td
          mat-cell
          *matCellDef="let element"
          (click)="openLink(element.FacebookLink)"
        >
          {{ element.FacebookFollowers | numberFormat }}
        </td>
      </ng-container>

      <ng-container matColumnDef="Action">
        <th mat-header-cell *matHeaderCellDef sticky>View | Edit</th>
        <td mat-cell *matCellDef="let element">
          <button class="icon-btn" (click)="viewInfluencer(element.id)">
            <mat-icon>remove_red_eye</mat-icon>
          </button>

          <button class="icon-btn" (click)="editInfluencer(element.id)">
            <mat-icon>create</mat-icon>
          </button>

          <mat-icon
            *ngIf="userRole == 'superadmin'"
            mat-raised-button
            color="warn"
            (click)="deleteInfluencer(element.id)"
          >
            delete
          </mat-icon>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" sticky></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" sticky></tr>
    </table>
    <mat-paginator
      pageSize="50"
      [pageSizeOptions]="[5, 10, 25, 50, 100]"
      (page)="onPageChange($event)"
      showFirstLastButtons
      aria-label="Select page"
    >
    </mat-paginator>
  </div>
</div>
